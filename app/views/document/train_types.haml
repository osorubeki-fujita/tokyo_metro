= render "common_content"

= document_title_of_each_content( @title_ja , @title_en )
%div{ id: :train_types }
  - # 鉄道事業者ごとに分類
  - # railway_line_id をもとに鉄道事業者を取得
  - train_types_grouped_by_operator = @train_types.where.not( same_as: "custom.TrainTypeUndefined" ).group_by { | train_type | train_type.railway_line.operator.id }
  - train_types_grouped_by_operator.keys.sort.each do | operator_id |
    - operator_instance = ::Operator.find_by( id: operator_id )
    - train_types_in_an_operator = train_types_grouped_by_operator[ operator_id ]
    %div{ class: [ :operator , operator_instance.css_class_name ] }
      %div{ class: :operator_name }
        %h3{ class: :text_ja }<
          = operator_instance.name_ja
        %h4{ class: :text_en }<
          = operator_instance.name_en
      - # 路線ごとに分類
      - # railway_line_id をもとに路線を取得
      - train_types_grouped_by_railway_line = train_types_in_an_operator.group_by { | train_type | train_type.railway_line.id }
      - train_types_grouped_by_railway_line.keys.sort.each do | railway_line_id |
        - railway_line_instance = ::RailwayLine.find_by( id: railway_line_id )
        - train_types_in_a_railway_line = train_types_grouped_by_railway_line[ railway_line_id ]
        %div{ class: [ :railway_line , railway_line_instance.css_class_name ] }
          %div{ class: :railway_line_name }
            %h4{ class: :text_ja }<
              = railway_line_instance.name_ja
            %h5{ class: :text_en }<
              = railway_line_instance.name_en
          - train_types_in_a_railway_line.each do | train_type |
            = render( "train_type_info" , train_type: train_type )